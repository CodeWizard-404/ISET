{"version":3,"file":"xmlHandler.js","names":["_createForOfIteratorHelper","o","allowArrayLike","it","Symbol","iterator","Array","isArray","_unsupportedIterableToArray","length","i","F","s","n","done","value","e","_e","f","TypeError","normalCompletion","didErr","err","call","step","next","_e2","return","minLen","_arrayLikeToArray","Object","prototype","toString","slice","constructor","name","from","test","arr","len","arr2","xmlBuilder","require","sax","stream","assert","selectn","debug","descriptor","ElementDescriptor","AttributeDescriptor","TypeDescriptor","QName","helper","NamespaceContext","XMLHandler","schemas","options","valueKey","xmlKey","attributesKey","xsiTypeKey","date","timezone","enabled","jsonToXml","node","nsContext","val","begin","version","encoding","standalone","nameSpaceContextCreated","toXmlDateOrTime","qname","form","attribute","mapping","declareNamespace","prefix","nsURI","attrName","isSimple","attrs","isMany","element","elementName","xmlns","pushContext","getPrefixMapping","newlyDeclared","declared","replace","cdata","raw","enforceRestrictions","type","schema","simpleTypes","anonymous","restriction","enforce","isNillable","namespaces","xsi","addAttributes","popContext","p","child","refOriginal","typeDescriptor","inheritance","extension","elements","concat","Date","text","mapObject","undefined","getXsiType","xsiTypeDescriptor","xsiType","parse","xsiTypeInfo","complexTypes","describe","_sortKeys","elementOrder","compare","n1","n2","order","i1","indexOf","i2","keys","names","sort","result","attributes","elementDescriptor","push","a","attributeDescriptor","attributeName","_iterator","_step","childDescriptor","ignoreUnknownProperties","attrDescriptors","createSOAPEnvelope","doc","create","header","body","createSOAPEnvelopeDescriptor","parameterDescriptor","envelopeDescriptor","addElement","headerDescriptor","bodyDescriptor","add","headers","faults","xsdStr","xsd","faultDescriptor","detailDescriptor","parseXml","root","xml","cb","parser","stringMode","opt","Readable","createStream","current","stack","onerror","process","nextTick","ontext","isDocument","trim","oncdata","onopentag","onclosetag","nsName","top","pop","onend","write","close","pipe","_processText","object","xmlToJson","self","refs","id","obj","elementAttributes","substring","addNamespace","isXsiType","xsiXmlns","getNamespaceURI","attrDescriptor","findAttribute","attrValue","parseValue","elementQName","href","substr","hrefs","parent","key","findElement","handleJsonObject","merge","j","hasOwnProperty","ref","Envelope","Body","Fault","errorMessage","getSoap11FaultErrorMessage","getSoap12FaultErrorMessage","error","Error","faultBody","faultcode","faultstring","faultactor","detail","JSON","stringify","code","subCode","reason","role","uri","jsType","dateText","Boolean","toXmlDate","isoStr","toISOString","formattedDate","split","withTimezone","toXmlTime","toXmlDateTime","module","exports"],"sources":["../../src/parser/xmlHandler.js"],"sourcesContent":["// Copyright IBM Corp. 2016,2019. All Rights Reserved.\n// Node module: strong-soap\n// This file is licensed under the MIT License.\n// License text available at https://opensource.org/licenses/MIT\n\n'use strict';\n\nvar xmlBuilder = require('xmlbuilder');\nvar sax = require('sax');\nvar stream = require('stream');\nvar assert = require('assert');\nvar selectn = require('selectn');\nvar debug = require('debug')('strong-soap:xmlhandler');\nvar descriptor = require('./xsd/descriptor');\nvar ElementDescriptor = descriptor.ElementDescriptor;\nvar AttributeDescriptor = descriptor.AttributeDescriptor;\nvar TypeDescriptor = descriptor.TypeDescriptor;\nvar QName = require('./qname');\nvar helper = require('./helper');\nvar NamespaceContext = require('./nscontext');\n\n\nclass XMLHandler {\n  /**\n   * @param {Object} [schemas] \n   * @param {Object} [options]\n   * @param {boolean} [options.enforceRestrictions]\n   * @param {string} [options.valueKey]\n   * @param {string} [options.xmlKey]\n   * @param {string} [options.attributesKey]\n   * @param {string} [options.xsiTypeKey]\n   * @param {Object} [options.date]\n   * @param {Object} [options.date.timezone]\n   * @param {boolean} [options.date.timezone.enabled]\n   */\n  constructor(schemas, options) {\n    this.schemas = schemas || {};\n    this.options = options || {};\n    this.options.valueKey = this.options.valueKey || '$value';\n    this.options.xmlKey = this.options.xmlKey || '$xml';\n    this.options.attributesKey = this.options.attributesKey || '$attributes';\n    this.options.xsiTypeKey = this.options.xsiTypeKey || '$xsiType';\n    this.options.date = this.options.date || {};\n    this.options.date.timezone = this.options.date.timezone || {};\n    this.options.date.timezone.enabled = typeof this.options.date.timezone.enabled === 'boolean' ? this.options.date.timezone.enabled : true;\n  }\n\n  jsonToXml(node, nsContext, descriptor, val) {\n    if (node == null) {\n      node = xmlBuilder.begin(\n        {version: '1.0', encoding: 'UTF-8', standalone: true});\n    }\n    if (nsContext == null) {\n      nsContext = new NamespaceContext();\n    }\n\n    var name;\n    let nameSpaceContextCreated = false;\n    if (descriptor instanceof AttributeDescriptor) {\n      val = toXmlDateOrTime(descriptor, val, this.options.date);\n      name = descriptor.qname.name;\n      if (descriptor.form === 'unqualified') {\n        node.attribute(name, val);\n      } else if (descriptor.qname) {\n        let mapping = declareNamespace(nsContext, node, descriptor.qname.prefix,\n          descriptor.qname.nsURI);\n        let prefix = mapping ? mapping.prefix : descriptor.qname.prefix;\n        let attrName = prefix ? prefix + ':' + name : name;\n        node.attribute(attrName, val);\n      }\n      return node;\n    }\n\n    if (descriptor instanceof ElementDescriptor) {\n      name = descriptor.qname.name;\n      let isSimple = descriptor.isSimple;\n      let attrs = null;\n      if (descriptor.isMany) {\n        if (Array.isArray(val)) {\n          for (let i = 0, n = val.length; i < n; i++) {\n            node = this.jsonToXml(node, nsContext, descriptor, val[i]);\n          }\n          return node;\n        }\n      }\n      if(val !== null && typeof val === \"object\"){\n        // check for $attributes field\n        if (typeof val[this.options.attributesKey] !== \"undefined\"){\n          attrs = val[this.options.attributesKey];\n        }\n        // add any $value field as xml element value\n        if (typeof val[this.options.valueKey] !== \"undefined\"){\n          val = val[this.options.valueKey];\n        }\n      }\n      let element;\n      let elementName;\n      let xmlns;\n      if (descriptor.form === 'unqualified') {\n        elementName = name;\n        nsContext.pushContext();\n        nameSpaceContextCreated = true;\n      } else if (descriptor.qname) {\n        nsContext.pushContext();\n        nameSpaceContextCreated = true;\n        // get the mapping for the namespace uri\n        let mapping = nsContext.getPrefixMapping(descriptor.qname.nsURI);\n        let newlyDeclared = false;\n        // if namespace not declared, declare it\n        if (mapping === null || mapping.declared === false) {\n          newlyDeclared = true;\n          mapping = declareNamespace(nsContext, null,\n          descriptor.qname.prefix, descriptor.qname.nsURI);\n        }\n        // add the element to a parent node\n        let prefix = mapping ? mapping.prefix : descriptor.qname.prefix;\n        elementName = prefix ? prefix + ':' + name : name;\n        // if namespace is newly declared add the xmlns attribute\n        if (newlyDeclared) {\n          xmlns = prefix ? 'xmlns:' + prefix : 'xmlns';\n        }\n      }\n\n      // add the element to a parent node\n      if (isSimple && /<!\\[CDATA/.test(val)) {\n        element = node.element(elementName);\n        val = val.replace(\"<![CDATA[\",\"\");\n        val = val.replace(\"]]>\",\"\");\n        element.cdata(val);\n      }else if(isSimple && typeof val !== \"undefined\" && val !== null\n        && typeof val[this.options.xmlKey] !== \"undefined\") {\n        val = val[this.options.xmlKey];\n        element = node.element(elementName);\n        val = toXmlDateOrTime(descriptor, val, this.options.date);\n        element.raw(val);\n      } else {\n        // Enforce the type restrictions if configured for such\n        if (this.options.enforceRestrictions && descriptor.type) {\n          const schema = this.schemas[descriptor.type.nsURI];\n          if (schema) {\n            let type = schema.simpleTypes[descriptor.type.name];\n            // if type not available in global schema\n            // , check if it is embedded in descriptor as an anonymous type\n            if (!type && descriptor.type.anonymous) {\n              type = descriptor.type.anonymous;\n            }\n            if (type) {\n              const restriction = type.restriction;\n              if (restriction) {\n                val = restriction.enforce(val);\n              }\n            }\n          }\n        }\n        val = toXmlDateOrTime(descriptor, val, this.options.date);\n        element = isSimple ? node.element(elementName, val) : node.element(elementName);\n      }\n\n      if (xmlns && descriptor.qname.nsURI) {\n        if (typeof element.attribute === 'function') {\n          element.attribute(xmlns, descriptor.qname.nsURI);\n        }\n      }\n\n      if (val == null) {\n        if (descriptor.isNillable) {\n          // Set xsi:nil = true\n          declareNamespace(nsContext, element, 'xsi', helper.namespaces.xsi);\n          if (typeof element.attribute === 'function') {\n            element.attribute('xsi:nil', true);\n          }\n        }\n      }\n\n      if (isSimple) {\n        if (attrs !== null) {\n          // add each field in $attributes object as xml element attribute\n          if (typeof attrs === \"object\") {\n            //add $attributes. Attribute can be an attribute defined in XSD or an xsi:type\n            this.addAttributes(element, nsContext, descriptor, val, attrs);\n          }\n        }\n        if (nameSpaceContextCreated) {\n          nsContext.popContext();\n        }\n        return node;\n      } else if ( val != null) {\n\n        let attrs = val[this.options.attributesKey];\n        if (typeof attrs === 'object') {\n          for (let p in attrs) {\n            let child = attrs[p];\n            if (p === this.options.xsiTypeKey) {\n              if (descriptor instanceof ElementDescriptor) {\n                if (descriptor.refOriginal) {\n                  if (descriptor.refOriginal.typeDescriptor) {\n                    if (descriptor.refOriginal.typeDescriptor.inheritance){\n                      let extension = descriptor.refOriginal.typeDescriptor.inheritance[child.type];\n                      if (extension) {\n                        descriptor.elements = descriptor.elements.concat(extension.elements);\n                      }\n                    }\n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n      //val is not an object - simple or date types\n      if (val != null && ( typeof val !== 'object' || val instanceof Date)) {\n        // for adding a field value nsContext.popContext() shouldnt be called\n        val = toXmlDateOrTime(descriptor, val, this.options.date);\n        element.text(val);\n        //add $attributes. Attribute can be an attribute defined in XSD or an xsi:type.\n        //e.g of xsi:type <name xmlns=\"..\" xmlns:xsi=\"...\" xmlns:ns=\"...\" xsi:type=\"ns:string\">some name</name>\n        if (attrs != null) {\n          this.addAttributes(element, nsContext, descriptor, val, attrs);\n        }\n        if (nameSpaceContextCreated) {\n          nsContext.popContext();\n        }\n        return node;\n      }\n\n      this.mapObject(element, nsContext, descriptor, val, attrs);\n      if (nameSpaceContextCreated) {\n        nsContext.popContext();\n      }\n      return node;\n    }\n\n    if (descriptor == null  || descriptor === undefined || descriptor instanceof TypeDescriptor) {\n      this.mapObject(node, nsContext, descriptor, val);\n      return node;\n    }\n\n    return node;\n  }\n\n  /**\n   * Check if the attributes have xsi:type and return the xsi type descriptor if exists\n   * @param {*} descriptor The current descriptor\n   * @param {*} attrs An object of attribute values\n   */\n  getXsiType(descriptor, attrs) {\n    var xsiTypeDescriptor;\n    if (attrs != null && typeof attrs === \"object\") {\n      for (let p in attrs) {\n        let child = attrs[p];\n        // if field is $xsiType add xsi:type attribute\n        if (p === this.options.xsiTypeKey) {\n          let xsiType;\n          if (typeof child === \"object\" && typeof child.type !== \"undefined\") {\n            // $xsiType has two fields - type, xmlns\n            xsiType = QName.parse(child.type, child.xmlns);\n          } else {\n            xsiType = QName.parse(child);\n          }\n          var schema = this.schemas[xsiType.nsURI];\n          if (schema) {\n            var xsiTypeInfo =\n              schema.complexTypes[xsiType.name] ||\n              schema.simpleTypes[xsiType.name];\n            // The type might not be described\n            // describe() takes wsdl definitions\n            xsiTypeDescriptor = xsiTypeInfo && xsiTypeInfo.describe({schemas: this.schemas});\n          }\n          break;\n        }\n      }\n    }\n    return xsiTypeDescriptor;\n  }\n\n  _sortKeys(val, elementOrder) {\n    function compare(n1, n2, order) {\n      let i1 = order.indexOf(n1);\n      if (i1 === -1) i1 = order.length;\n      let i2 = order.indexOf(n2);\n      if (i2 === -1) i2 = order.length;\n      return i1 - i2;\n    }\n    const keys = Object.keys(val);\n    var names = [].concat(keys).sort((n1, n2) => {\n      let result = compare(n1, n2, elementOrder);\n      if (result ===0) {\n        result = compare(n1, n2, keys);\n      }\n      return result;\n    });\n    return names;\n  }\n\n  /**\n   * Map a JSON object into an XML type\n   * @param {XMLElement} node The root node\n   * @param {NamespaceContext} nsContext Namespace context\n   * @param {TypeDescriptor|ElementDescriptor} descriptor\n   * @param {Object} val\n   * @returns {*}\n   */\n  mapObject(node, nsContext, descriptor, val, attrs) {\n    if (val == null) return node;\n    if (typeof val !== 'object' || (val instanceof Date)) {\n      val = toXmlDateOrTime(descriptor, val, this.options.date);\n      node.text(val);\n      return node;\n    }\n\n    // First try to see if a subtype should be used\n    var xsiType = this.getXsiType(descriptor, attrs);\n    descriptor = xsiType || descriptor;\n\n    var elements = {}, attributes = {};\n    var elementOrder = [];\n    if (descriptor != null) {\n      for (let i = 0, n = descriptor.elements.length; i < n; i++) {\n        let elementDescriptor = descriptor.elements[i];\n        let elementName = elementDescriptor.qname.name;\n        elements[elementName] = elementDescriptor;\n        elementOrder.push(elementName);\n      }\n    }\n\n    if (descriptor != null) {\n      for (let a in descriptor.attributes) {\n        let attributeDescriptor = descriptor.attributes[a];\n        let attributeName = attributeDescriptor.qname.name;\n        attributes[attributeName] = attributeDescriptor;\n      }\n    }\n\n    // handle later if value is an array\n    if (!Array.isArray(val)) {\n      const names = this._sortKeys(val, elementOrder);\n      for (let p of names) {\n        if (p === this.options.attributesKey)\n          continue;\n\t      let child = val[p];\n\t      let childDescriptor = elements[p] || attributes[p];\n\t      if (childDescriptor == null) {\n\t        if (this.options.ignoreUnknownProperties)\n            continue;\n          else\n            childDescriptor = new ElementDescriptor(\n              QName.parse(p), null, 'unqualified', Array.isArray(child));\n        }\n        if (childDescriptor) {\n          this.jsonToXml(node, nsContext, childDescriptor, child);\n        }\n\t    }\n    }\n\n    this.addAttributes(node, nsContext, descriptor, val, attrs);\n\n    return node;\n  }\n\n  addAttributes(node, nsContext, descriptor, val, attrs) {\n    var attrDescriptors = (descriptor && descriptor.attributes) || [];\n    var attributes = {};\n    for (var i = 0; i < attrDescriptors.length; i++) {\n      var qname = attrDescriptors[i].qname;\n      attributes[qname.name] = attrDescriptors[i];\n    }\n    if (attrs != null && typeof attrs === 'object') {\n      for (let p in attrs) {\n        let child = attrs[p];\n        // if field is $xsiType add xsi:type attribute\n        if (p === this.options.xsiTypeKey) {\n          let xsiType;\n          if(typeof child === 'object' && typeof child.type !== 'undefined') {\n            // $xsiType has two fields - type, xmlns\n            xsiType = QName.parse(child.type, child.xmlns);\n          } else {\n            xsiType = QName.parse(child);\n          }\n          declareNamespace(nsContext, node, 'xsi', helper.namespaces.xsi);\n          let mapping = declareNamespace(nsContext, node, xsiType.prefix,\n            xsiType.nsURI);\n          let prefix = mapping ? mapping.prefix : xsiType.prefix;\n          node.attribute('xsi:type', prefix ? prefix + ':' + xsiType.name :\n            xsiType.name);\n          continue;\n        }\n        let childDescriptor = attributes[p];\n        if (childDescriptor == null) {\n          if (this.options.ignoreUnknownProperties) continue;\n          else {\n            childDescriptor =\n              new AttributeDescriptor(QName.parse(p), null, 'unqualified');\n          }\n        }\n        this.jsonToXml(node, nsContext, childDescriptor, child);\n      }\n    }\n  }\n\n  static createSOAPEnvelope(prefix, nsURI) {\n    prefix = prefix || 'soap';\n    var doc = xmlBuilder.create(prefix + ':Envelope',\n      {version: '1.0', encoding: 'UTF-8', standalone: true});\n    nsURI = nsURI || 'http://schemas.xmlsoap.org/soap/envelope/';\n    doc.attribute('xmlns:' + prefix,\n      nsURI);\n    let header = doc.element(prefix + ':Header');\n    let body = doc.element(prefix + ':Body');\n    return {\n      body: body,\n      header: header,\n      doc: doc\n    };\n  }\n\n  static createSOAPEnvelopeDescriptor(prefix, nsURI, parameterDescriptor) {\n    prefix = prefix || 'soap';\n    nsURI = nsURI || 'http://schemas.xmlsoap.org/soap/envelope/';\n    var descriptor = new TypeDescriptor();\n\n    var envelopeDescriptor = new ElementDescriptor(\n      new QName(nsURI, 'Envelope', prefix), null, 'qualified', false);\n    descriptor.addElement(envelopeDescriptor);\n\n    var headerDescriptor = new ElementDescriptor(\n      new QName(nsURI, 'Header', prefix), null, 'qualified', false);\n\n    var bodyDescriptor = new ElementDescriptor(\n      new QName(nsURI, 'Body', prefix), null, 'qualified', false);\n\n    envelopeDescriptor.addElement(headerDescriptor);\n    envelopeDescriptor.addElement(bodyDescriptor);\n\n    if (parameterDescriptor && parameterDescriptor.body) {\n      bodyDescriptor.add(parameterDescriptor.body);\n    }\n\n    if (parameterDescriptor && parameterDescriptor.headers) {\n      bodyDescriptor.add(parameterDescriptor.headers);\n    }\n\n    if (parameterDescriptor && parameterDescriptor.faults) {\n      var xsdStr = new QName(helper.namespaces.xsd, 'string', 'xsd');\n      var faultDescriptor = new ElementDescriptor(\n        new QName(nsURI, 'Fault', prefix), null, 'qualified', false);\n      faultDescriptor.addElement(\n        new ElementDescriptor(nsURI, 'faultcode', xsdStr, 'qualified', false));\n      faultDescriptor.addElement(\n        new ElementDescriptor(nsURI, 'faultstring', xsdStr, 'qualified', false));\n      faultDescriptor.addElement(\n        new ElementDescriptor(nsURI, 'faultactor', xsdStr, 'qualified', false));\n      var detailDescriptor =\n        new ElementDescriptor(nsURI, 'detail', null, 'qualified', false);\n      faultDescriptor.addElement(detailDescriptor);\n\n      for (var f in parameterDescriptor.faults) {\n        detailDescriptor.add(parameterDescriptor.faults[f]);\n      }\n    }\n\n    return descriptor;\n  }\n\n  /**\n   * Parse XML string or stream into the XMLBuilder tree\n   * @param root The root node\n   * @param xml XML string or stream\n   * @param cb\n   * @returns {*}\n   */\n  static parseXml(root, xml, cb) {\n    let parser;\n    let stringMode = true;\n    debug('XMLHandler parseXML. root: %j xml: %j', root, xml);\n    if (typeof xml === 'string') {\n      stringMode = true;\n      parser = sax.parser(true, {opt: {xmlns: true}});\n    } else if (xml instanceof stream.Readable) {\n      stringMode = false;\n      parser = sax.createStream(true, {opt: {xmlns: true}});\n    }\n    if (!root) {\n      root = xmlBuilder.begin();\n    }\n    let current = root;\n    let stack = [root];\n\n    parser.onerror = function(e) {\n      // an error happened.\n      if (cb) process.nextTick(cb);\n    };\n\n    parser.ontext = function(text) {\n      // got some text.  t is the string of text.\n      if (current.isDocument) return;\n      text = text.trim();\n      if (text) {\n        current.text(text);\n      }\n    };\n\n    parser.oncdata = function(text) {\n      if (current.isDocument) return;\n      text = text.trim();\n      if (text) {\n        current.cdata(text);\n      }\n    };\n\n    parser.onopentag = function(node) {\n      // opened a tag.  node has \"name\" and \"attributes\"\n      let element = current.element(node.name);\n      if (node.attributes) {\n        element.attribute(node.attributes);\n      }\n      stack.push(element);\n      current = element;\n    };\n\n    parser.onclosetag = function(nsName) {\n      var top = stack.pop();\n      assert(top === current);\n      assert(top.name === nsName);\n      current = stack[stack.length - 1];\n    };\n\n    parser.onend = function() {\n      if (cb) process.nextTick(function() {\n        // parser stream is done, and ready to have more stuff written to it.\n        cb && cb(null, root);\n      });\n    };\n\n    if (stringMode) {\n      parser.write(xml).close();\n    } else {\n      xml.pipe(parser);\n    }\n    return root;\n  }\n\n  _processText(top, val) {\n    // The parent element has xsi:nil = true\n    if (top.object === null) return;\n    // Top object has no other elements or attributes\n    if (top.object === undefined) {\n      top.object = val;\n    } else if (top.object.constructor === Object) {\n      // Top object already has attributes or elements\n      let value = top.object[this.options.valueKey];\n      if (value !== undefined) {\n        top.object[this.options.valueKey] = value + val;\n      } else {\n        top.object[this.options.valueKey] = val;\n      }\n    } else {\n      // Top object is other simple types, such as string or date\n      top.object = top.object + val;\n    }\n  }\n\n  xmlToJson(nsContext, xml, descriptor) {\n    var self = this;\n    var p = sax.parser(true);\n    nsContext = nsContext || new NamespaceContext();\n    var root = {};\n    var refs = {}, id; // {id: {hrefs:[], obj:}, ...}\n    var stack = [{name: null, object: root, descriptor: descriptor}];\n    var options = this.options;\n\n    p.onopentag = function(node) {\n      nsContext.pushContext();\n      var top = stack[stack.length - 1];\n      var descriptor = top.descriptor;\n      var nsName = node.name;\n      var attrs = node.attributes;\n      var obj = undefined;\n      var elementAttributes = null;\n\n      // Register namespaces 1st\n      for (let a in attrs) {\n        if (/^xmlns:|^xmlns$/.test(a)) {\n          let prefix = (a === 'xmlns') ? '' : a.substring(6);\n          nsContext.addNamespace(prefix, attrs[a]);\n        }\n      }\n\n      // Handle regular attributes\n      for (let a in attrs) {\n        if (/^xmlns:|^xmlns$/.test(a)) continue;\n        let qname = QName.parse(a);\n        var isXsiType = false;\n        var xsiType = null;\n        var xsiXmlns = null;\n        if (nsContext.getNamespaceURI(qname.prefix) === helper.namespaces.xsi) {\n          // Handle xsi:*\n          if (qname.name == 'nil') {\n            // xsi:nil\n            if (attrs[a] === 'true') {\n              obj = null;\n            }\n            continue;\n          } else if (qname.name === 'type') {\n            // xsi:type\n            isXsiType = true;\n            xsiType = attrs[a];\n            xsiType = QName.parse(xsiType);\n            attrs[a] = xsiType.name;\n            if(xsiType.prefix){\n              xsiXmlns = nsContext.getNamespaceURI(xsiType.prefix);\n            }\n          }\n        }\n        let attrName = qname.name;\n        elementAttributes = elementAttributes || {};\n        let attrDescriptor = descriptor && descriptor.findAttribute(qname.name);\n        let attrValue = parseValue(attrs[a], attrDescriptor);\n        // if element attribute is xsi:type add $xsiType field\n        if (isXsiType) {\n          // $xsiType object has two fields - type and xmlns\n          xsiType = {};\n          xsiType.type = attrs[a];\n          xsiType.xmlns = xsiXmlns;\n          elementAttributes[options.xsiTypeKey] = xsiType;\n        } else {\n          elementAttributes[attrName] = attrs[a];\n        }\n      }\n\n      if (elementAttributes) {\n        obj = {};\n        obj[self.options.attributesKey] = elementAttributes;\n      }\n\n      var elementQName = QName.parse(nsName);\n      elementQName.nsURI = nsContext.getNamespaceURI(elementQName.prefix);\n\n      // SOAP href (#id)\n      if (attrs.href != null) {\n        id = attrs.href.substr(1);\n        if (refs[id] === undefined) {\n          refs[id] = {hrefs: [], object: null};\n        }\n        refs[id].hrefs.push({\n          parent: top.object, key: elementQName.name, object: obj\n        });\n      }\n      id = attrs.id;\n      if (id != null) {\n        if (refs[id] === undefined)\n          refs[id] = {hrefs: [], object: null};\n      }\n\n      stack.push({\n        name: elementQName.name,\n        object: obj,\n        descriptor: descriptor && descriptor.findElement(elementQName.name),\n        id: attrs.id,\n      });\n    };\n\n    p.onclosetag = function(nsName) {\n      var elementName = QName.parse(nsName).name;\n      nsContext.popContext();\n      var current = stack.pop();\n      var top = stack[stack.length - 1];\n      if (top.object === undefined) {\n        top.object = {};\n      }\n      if (top.object !== null) {\n        if (typeof top.object === 'object' && elementName in top.object) {\n          // The element exist already, let's create an array\n          let val = top.object[elementName];\n          if (Array.isArray(val)) {\n            // Add to the existing array\n            val.push(current.object);\n          } else {\n            // Convert the element value to an array\n            top.object[elementName] = [val, current.object];\n          }\n        } else {\n          if (current.descriptor && current.descriptor.isMany) {\n            top.object[elementName] = [current.object];\n          } else {\n            top.object[elementName] = current.object;\n          }\n        }\n      }\n      if (current.id != null) {\n        refs[current.id].object = current.object;\n      }\n    };\n\n    p.oncdata = function(text) {\n      text = text && text.trim();\n      if (!text.length)\n        return;\n\n      if (/<\\?xml[\\s\\S]+\\?>/.test(text)) {\n        text = self.xmlToJson(null, text);\n      }\n      // add contents of CDATA to the xml output as a text\n      p.handleJsonObject(text);\n    };\n\n    p.handleJsonObject = function(text) {\n      var top = stack[stack.length - 1];\n      self._processText(top, text);\n    };\n\n    p.ontext = function(text) {\n      text = text && text.trim();\n      if (!text.length)\n        return;\n\n      var top = stack[stack.length - 1];\n      var descriptor = top.descriptor;\n      var value = parseValue(text, descriptor);\n      self._processText(top, value);\n    };\n\n    p.write(xml).close();\n\n    // merge obj with href\n    var merge = function(href, obj) {\n      for (var j in obj) {\n        if (obj.hasOwnProperty(j)) {\n          href.object[j] = obj[j];\n        }\n      }\n    };\n\n    // MultiRef support: merge objects instead of replacing\n    for (let n in refs) {\n      var ref = refs[n];\n      for (var i = 0; i < ref.hrefs.length; i++) {\n        merge(ref.hrefs[i], ref.object);\n      }\n    }\n\n    if (root.Envelope) {\n      var body = root.Envelope.Body;\n      if (root.Envelope.Body !== undefined && root.Envelope.Body !== null) {\n        if (body.Fault !== undefined && body.Fault !== null) {\n          //check if fault is soap 1.1 fault\n          var errorMessage = getSoap11FaultErrorMessage(body.Fault);\n          //check if fault is soap 1.2 fault\n          if (errorMessage == null) {\n            errorMessage = getSoap12FaultErrorMessage(body.Fault);\n          }\n          //couldn't process error message for neither soap 1.1 nor soap 1.2 fault. Nothing else can be done at this point. Send a generic error message.\n          if (errorMessage == null) {\n            errorMessage = 'Error occurred processing Fault response.';\n          }\n          var error = new Error(errorMessage);\n          error.root = root;\n          throw error;\n        }\n      }\n      return root.Envelope;\n    }\n    return root;\n  }\n\n}\n\nfunction getSoap11FaultErrorMessage(faultBody) {\n  var errorMessage = null;\n  var faultcode = selectn('faultcode.$value', faultBody)||\n    selectn('faultcode', faultBody);\n  if (faultcode) { //soap 1.1 fault\n    errorMessage = ' ';\n    //All of the soap 1.1 fault elements should contain string value except detail element which may be a complex type or plain text (string)\n    if (typeof faultcode == 'string') {\n      errorMessage =  'faultcode: ' + faultcode;\n    }\n    var faultstring = selectn('faultstring.$value', faultBody) ||\n      selectn('faultstring', faultBody);\n    if (faultstring && (typeof faultstring == 'string')) {\n      errorMessage = errorMessage + ' faultstring: ' + faultstring;\n    }\n    var faultactor = selectn('faultactor.$value', faultBody) ||\n      selectn('faultactor', faultBody);\n    if (faultactor && (typeof faultactor == 'string')) {\n      errorMessage = errorMessage + ' faultactor: ' + faultactor;\n    }\n    var detail = selectn('detail.$value', faultBody) ||\n      selectn('detail', faultBody);\n    if (detail != null) {\n      if (typeof detail == 'string') { //plain text\n        errorMessage = errorMessage + ' detail: ' + detail;\n      } else { //XML type defined in wsdl\n        errorMessage = errorMessage + ' detail: ' + JSON.stringify(detail);\n      }\n    }\n  }\n  return errorMessage;\n}\n\nfunction getSoap12FaultErrorMessage(faultBody) {\n  var errorMessage = null;\n  let code = selectn('Code', faultBody)||\n    selectn('Code', faultBody);\n  if (code) {\n    //soap 1.2 fault elements have child elements. Hence use JSON.stringify to formulate the error message.\n    errorMessage = ' ';\n    errorMessage = errorMessage + 'Code: ' + JSON.stringify(code);\n    var value = selectn('Value.$value', faultBody) ||\n      selectn('Value', faultBody);\n    if (value) {\n      errorMessage = errorMessage + ' ' + 'Value: ' + JSON.stringify(value);\n    }\n    var subCode = selectn('Subcode.$value', faultBody) ||\n      selectn('Subcode', faultBody);\n    if (subCode) {\n      errorMessage = errorMessage + ' ' + 'Subcode: ' + JSON.stringify(subCode);\n    }\n    var reason = selectn('reason.$value', faultBody) ||\n      selectn('Reason', faultBody);\n    if (reason) {\n      errorMessage = errorMessage + ' ' + 'Reason: ' + JSON.stringify(reason);\n    }\n    var node = selectn('Node.$value', faultBody) ||\n      selectn('Node', faultBody);\n    if (node) {\n      errorMessage = errorMessage + ' ' + 'Node: ' + JSON.stringify(node);\n    }\n    var role = selectn('Role.$value', faultBody) ||\n      selectn('Role', faultBody);\n    if (role) {\n      errorMessage = errorMessage + ' ' + 'Role: ' + JSON.stringify(role);\n    }\n    var detail = selectn('Detail.$value', faultBody) ||\n      selectn('Detail', faultBody);\n    if (detail != null) {\n      if (typeof detail == 'string') { //plain text\n        errorMessage = errorMessage + ' Detail: ' + detail;\n      } else { //XML type defined in wsdl\n        errorMessage = errorMessage + ' Detail: ' + JSON.stringify(detail);\n      }\n    }\n  }\n  return errorMessage;\n}\n\n\nfunction declareNamespace(nsContext, node, prefix, nsURI) {\n  var mapping = nsContext.declareNamespace(prefix, nsURI);\n  if (!mapping) {\n    return false;\n  } else if (node) {\n    if (typeof node.attribute === 'function') {\n      // Some types of node such as XMLDummy does not allow attribute\n      node.attribute('xmlns:' + mapping.prefix, mapping.uri);\n    }\n    return mapping;\n  }\n  return mapping;\n}\n\nfunction parseValue(text, descriptor) {\n  if (typeof text !== 'string') return text;\n  var value = text;\n  var jsType = descriptor && descriptor.jsType;\n  if (jsType === Date) {\n    var dateText = text;\n    // Checks for xs:date with tz, drops the tz \n    // because xs:date doesn't have a time to offset\n    // and JS Date object doesn't store an arbitrary tz\n    if(dateText.length === 16){\n      dateText = text.substr(0, 10);\n    }\n    value = new Date(dateText);\n  } else if (jsType === Boolean) {\n    if (text === 'true' || text === '1') {\n      value = true;\n    } else {\n      value = false;\n    }\n  } else if (typeof jsType === 'function') {\n    value = jsType(text);\n  }\n  return value;\n}\n\n/**\n * \n * @param {string | Date} date \n * @param {Object} [options] \n * @param {Object} [options.timezone]\n * @param {boolean} [options.timezone.enabled]\n * @returns \n */\nfunction toXmlDate(date, options) {\n  try {\n    const isoStr = new Date(date).toISOString();\n    const formattedDate = isoStr.split('T')[0];\n    const withTimezone = (options && options.timezone) && typeof options.timezone.enabled === 'boolean' ? options.timezone.enabled : true;\n    if (!withTimezone) {\n      return formattedDate;\n    }\n    return formattedDate + 'Z';  \n  } catch (err) {\n    return date;\n  }\n}\n\nfunction toXmlTime(date) {\n  try {\n    const isoStr = new Date(date).toISOString();\n    return isoStr.split('T')[1];  \n  } catch (err) {\n    return date;\n  }\n}\n\nfunction toXmlDateTime(date) {\n  try {\n    return new Date(date).toISOString();  \n  } catch (err) {\n    return date; \n  }\n}\n\n/**\n * \n * @param {object} descriptor \n * @param {* | null} val \n * @param {Object} options\n * @param {Object} options.timezone\n * @param {boolean} options.timezone.enabled\n * @returns {string}\n */\nfunction toXmlDateOrTime(descriptor, val, options) {\n  if (!descriptor || !descriptor.type || val === null) return val;\n  if (descriptor.type.name === 'date') {\n    return toXmlDate(val, options);\n  } else if (descriptor.type.name === 'time') {\n    return toXmlTime(val);\n  } else if (descriptor.type.name === 'dateTime') {\n    return toXmlDateTime(val);\n  }\n  return val;\n}\n\nmodule.exports = XMLHandler;\n\n// Exported function for testing\nmodule.exports.parseValue = parseValue;\nmodule.exports.toXmlDate = toXmlDate;\nmodule.exports.toXmlTime = toXmlTime;\nmodule.exports.toXmlDateTime = toXmlDateTime;\n"],"mappings":"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","ignoreList":[]}