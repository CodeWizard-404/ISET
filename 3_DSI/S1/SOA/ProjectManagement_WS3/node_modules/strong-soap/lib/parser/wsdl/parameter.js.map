{"version":3,"file":"parameter.js","names":["WSDLElement","require","QName","debug","Parameter","constructor","nsName","attrs","options","addChild","child","name","body","headers","push","fault","postProcess","definitions","parent","messageName","parse","$message","message","messages","console","error","Error","$parts","parts","split","i","n","length","header","$part","part","p","allowedChildren","module","exports"],"sources":["../../../src/parser/wsdl/parameter.js"],"sourcesContent":["// Copyright IBM Corp. 2016,2018. All Rights Reserved.\n// Node module: strong-soap\n// This file is licensed under the MIT License.\n// License text available at https://opensource.org/licenses/MIT\n\n'use strict';\n\nvar WSDLElement = require('./wsdlElement');\nvar QName = require('../qname');\nvar debug = require('debug')('strong-soap:wsdl:parameter');\n\n/**\n * Base class for Input/Output\n */\nclass Parameter extends WSDLElement {\n  constructor(nsName, attrs, options) {\n    super(nsName, attrs, options);\n  }\n\n  addChild(child) {\n    // soap:body\n    if (child.name === 'body') {\n      this.body = child;\n    } else if (child.name === 'header') {\n      this.headers = this.headers || [];\n      // soap:header\n      this.headers.push(child);\n    } else if (child.name === 'fault') {\n      //Revisit. Never gets executed.\n      this.fault = child;\n    }\n  }\n\n  postProcess(definitions) {\n    // portType.operation.*\n    if (this.parent.parent.name === 'portType') {\n      // Resolve $message\n      var messageName = QName.parse(this.$message).name;\n      var message = definitions.messages[messageName];\n      if (!message) {\n        console.error('Unable to resolve message %s for', this.$message, this);\n        throw new Error('Unable to resolve message ' + this.$message);\n      }\n      message.postProcess(definitions);\n      this.message = message;\n    }\n\n    // binding.operation.*\n    if (this.parent.parent.name === 'binding') {\n      if (this.body) {\n        if (this.body.$parts) {\n          this.body.parts = {};\n          let parts = this.body.$parts.split(/\\s+/);\n          for (let i = 0, n = parts.length; i < n; i++) {\n            this.body.parts[parts[i]] = this.message.parts[parts[i]];\n          }\n        } else {\n          if (this.message && this.message.parts) {\n            this.body.parts = this.message.parts;\n          }\n        }\n      }\n      if (this.headers) {\n        for (let i = 0, n = this.headers.length; i < n; i++) {\n          let header = this.headers[i];\n          let message;\n          if (header.$message) {\n            let messageName = QName.parse(header.$message).name;\n            message = definitions.messages[messageName];\n            if (message) {\n              message.postProcess(definitions);\n            } else {\n              debug('Message not found: ', header.$message);\n            }\n          } else {\n            message = this.message;\n          }\n          if (header.$part && message) {\n            header.part = message.parts[header.$part];\n          }\n        }\n      }\n      //Revisit.. this.name is always undefined because there is no code which calls addChild(..) with child.name = 'fault.\n      //code works inspite of not executing this block. Remove it?\n      if (this.name === 'fault') {\n        let message = this.fault.parent.message;\n        if (message) {\n          message.postProcess(definitions);\n          for (let p in message.parts) {\n            // The fault message MUST have only one part per WSDL 1.1 spec\n            this.fault.part = message.parts[p];\n            break;\n          }\n        } else {\n          debug('Message not found: ', this.fault.$message);\n        }\n      }\n    }\n  }\n}\n\nParameter.allowedChildren = [\n  'body',\n  'SecuritySpecRef',\n  'documentation',\n  'header'\n];\n\nmodule.exports = Parameter;\n"],"mappings":"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","ignoreList":[]}