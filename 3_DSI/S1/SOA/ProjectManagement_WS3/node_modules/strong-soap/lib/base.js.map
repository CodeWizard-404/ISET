{"version":3,"file":"base.js","names":["EventEmitter","require","NamespaceContext","SOAPElement","xmlBuilder","XMLHandler","Base","constructor","wsdl","options","_initializeOptions","soapHeaders","httpHeaders","bodyAttributes","addSoapHeader","value","qname","header","push","changeSoapHeader","index","getSoapHeaders","clearSoapHeaders","setHttpHeader","name","String","addHttpHeader","val","getHttpHeaders","clearHttpHeaders","attributesKey","envelopeKey","forceSoapVersion","prettyResponse","undefined","createSOAPEnvelope","prefix","nsURI","doc","create","version","encoding","standalone","attribute","element","body","findElement","schemas","definitions","schema","elements","createNamespaceContext","soapNsPrefix","soapNsURI","nsContext","declareNamespace","namespaces","xmlns","indexOf","addNamespace","addSoapHeadersToEnvelope","soapHeaderElement","xmlHandler","i","n","length","soapHeader","elementDescriptor","describe","jsonToXml","parseXml","xml","module","exports"],"sources":["../src/base.js"],"sourcesContent":["// Copyright IBM Corp. 2016,2017. All Rights Reserved.\n// Node module: strong-soap\n// This file is licensed under the MIT License.\n// License text available at https://opensource.org/licenses/MIT\n\n'use strict';\n\nvar EventEmitter = require('events').EventEmitter;\nvar NamespaceContext = require('./parser/nscontext');\nvar SOAPElement = require('./soapModel').SOAPElement;\nvar xmlBuilder = require('xmlbuilder');\nvar XMLHandler = require('./parser/xmlHandler');\n  \nclass Base extends EventEmitter {\n  constructor(wsdl, options) {\n    super();\n    this.wsdl = wsdl;\n    this._initializeOptions(options);\n    this.soapHeaders = [];\n    this.httpHeaders = {};\n    this.bodyAttributes = [];\n  }\n\n  addSoapHeader(value, qname) {\n    var header = new SOAPElement(value, qname, null);\n    return this.soapHeaders.push(header) - 1;\n  }\n\n  changeSoapHeader(index, value, qname) {\n    var header = new SOAPElement(value, qname, null);\n    this.soapHeaders[index] = header;\n  }\n\n\n  getSoapHeaders() {\n    return this.soapHeaders;\n  }\n\n  clearSoapHeaders() {\n    this.soapHeaders = [];\n  }\n\n  setHttpHeader(name, value) {\n    this.httpHeaders[name] = String(value);\n  }\n\n  addHttpHeader(name, value) {\n    var val = this.httpHeaders[name];\n    if (val != null) {\n      this.httpHeaders[name] = val + ', ' + value;\n    } else {\n      this.httpHeaders[name] = String(value);\n    }\n  }\n\n  getHttpHeaders() {\n    return this.httpHeaders;\n  }\n\n  clearHttpHeaders() {\n    this.httpHeaders = {};\n  }\n\n  _initializeOptions(options) {\n    options = options || {};\n    this.wsdl.options.attributesKey = options.attributesKey || 'attributes';\n    this.wsdl.options.envelopeKey = options.envelopeKey || 'soap';\n    this.wsdl.options.forceSoapVersion = options.forceSoapVersion;\n    this.wsdl.options.prettyResponse = options.prettyResponse !== undefined ? options.prettyResponse : true;\n  }\n\n  static createSOAPEnvelope(prefix, nsURI) {\n    prefix = prefix || 'soap';\n    nsURI = nsURI || 'http://schemas.xmlsoap.org/soap/envelope/';\n    var doc = xmlBuilder.create(prefix + ':Envelope',\n      {version: '1.0', encoding: 'UTF-8', standalone: true});\n    doc.attribute('xmlns:' + prefix, nsURI);\n    let header = doc.element(prefix + ':Header');\n    let body = doc.element(prefix + ':Body');\n    return {\n      body: body,\n      header: header,\n      doc: doc\n    };\n  }\n\n  findElement(nsURI, name) {\n    var schemas = this.wsdl.definitions.schemas;\n    var schema = schemas[nsURI];\n    return schema && schema.elements[name];\n  }\n\n  createNamespaceContext(soapNsPrefix, soapNsURI) {\n    var nsContext = new NamespaceContext();\n    nsContext.declareNamespace(soapNsPrefix, soapNsURI);\n\n    var namespaces = this.wsdl.definitions.xmlns || {};\n    for (var prefix in namespaces) {\n      if (prefix === '')\n        continue;\n      var nsURI = namespaces[prefix];\n      switch (nsURI) {\n        case \"http://xml.apache.org/xml-soap\" : // apachesoap\n        case \"http://schemas.xmlsoap.org/wsdl/\" : // wsdl\n        case \"http://schemas.xmlsoap.org/wsdl/soap/\" : // wsdlsoap\n        case \"http://schemas.xmlsoap.org/wsdl/soap12/\": // wsdlsoap12\n        case \"http://schemas.xmlsoap.org/soap/encoding/\" : // soapenc\n        case \"http://www.w3.org/2001/XMLSchema\" : // xsd\n          continue;\n      }\n      if (~nsURI.indexOf('http://schemas.xmlsoap.org/'))\n        continue;\n      if (~nsURI.indexOf('http://www.w3.org/'))\n        continue;\n      if (~nsURI.indexOf('http://xml.apache.org/'))\n        continue;\n      nsContext.addNamespace(prefix, nsURI);\n    }\n    return nsContext;\n  }\n\n  addSoapHeadersToEnvelope(soapHeaderElement, xmlHandler) {\n    for (let i = 0, n = this.soapHeaders.length; i < n; i++) {\n      let soapHeader = this.soapHeaders[i];\n      let elementDescriptor;\n      if (typeof soapHeader.value === 'object') {\n        if (soapHeader.qname && soapHeader.qname.nsURI) {\n            let element = this.findElement(soapHeader.qname.nsURI, soapHeader.qname.name);\n            elementDescriptor =\n              element && element.describe(this.wsdl.definitions);\n        }\n        xmlHandler.jsonToXml(soapHeaderElement, null, elementDescriptor,\n          soapHeader.value);\n      } else { //soapHeader has XML value\n        XMLHandler.parseXml(soapHeaderElement, soapHeader.xml);\n      }\n    }\n  }\n\n}\n\nmodule.exports = Base;\n"],"mappings":"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","ignoreList":[]}