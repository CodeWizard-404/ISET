{"version":3,"file":"client.js","names":["g","require","HttpClient","assert","xmlBuilder","XMLHandler","NamespaceContext","Operation","SOAPElement","Base","util","_","debug","debugDetail","debugSensitive","utils","Client","constructor","wsdl","endpoint","options","xmlHandler","definitions","schemas","_initializeServices","httpClient","setEndpoint","describe","describeServices","setSecurity","security","setSOAPAction","soapAction","SOAPAction","services","name","_defineService","service","ports","def","_definePort","location","port","binding","operations","_defineOperation","operation","self","temp","args","callback","extraHeaders","undefined","createPromiseCallback","_invoke","promise","$name","input","output","style","defs","ns","$targetNamespace","encoding","message","xml","req","headers","dynamicSoapHeaderProperty","dynamicSoapHeaders","soapNsURI","soapNsPrefix","envelopeKey","soapVersion","forceSoapVersion","lastIndexOf","length","soapActionRequired","merge","pick","omit","header","httpHeaders","attr","isEmpty","clearSoapHeaders","addSoapHeader","NTLMSecurity","addHttpHeaders","addOptions","nsContext","createNamespaceContext","envelope","createSOAPEnvelope","soapHeaderElement","soapBodyElement","body","addSoapHeadersToEnvelope","addSoapHeaders","uri","complexTypes","type","describeChildren","operationDescriptor","inputBodyDescriptor","inputHeadersDescriptor","jsonToXml","postProcess","prettyPrint","toString","pretty","doc","end","lastMessage","lastRequest","lastEndpoint","emit","tryJSONparse","JSON","parse","err","request","response","result","obj","lastResponse","lastResponseHeaders","lastElapsedTime","elapsedTime","indexOf","outputEnvDescriptor","faultEnvelope","outputEnvelope","xmlToJson","error","json","isObject","Body","Header","Error","f","outputBodyDescriptor","outputHeadersDescriptor","elements","qname","outputName","replace","forEach","term","hasOwnProperty","lastRequestHeaders","module","exports"],"sources":["../src/client.js"],"sourcesContent":["// Copyright IBM Corp. 2016,2019. All Rights Reserved.\n// Node module: strong-soap\n// This file is licensed under the MIT License.\n// License text available at https://opensource.org/licenses/MIT\n\n'use strict';\n\nvar g = require('./globalize');\nvar HttpClient = require('./http'),\n  assert = require('assert'),\n  xmlBuilder = require('xmlbuilder'),\n  XMLHandler = require('./parser/xmlHandler'),\n  NamespaceContext = require('./parser/nscontext'),\n  Operation = require('./parser/wsdl/operation'),\n  SOAPElement = require('./soapModel').SOAPElement,\n  Base = require('./base'),\n  util = require('util'),\n  _ = require('lodash'),\n  debug = require('debug')('strong-soap:client'),\n  debugDetail = require('debug')('strong-soap:client:detail'),\n  debugSensitive = require('debug')('strong-soap:client:sensitive'),\n  utils = require('./utils');\n\nclass Client extends Base {\n  constructor(wsdl, endpoint, options) {\n    super(wsdl, options);\n    options = options || {};\n    this.xmlHandler = new XMLHandler(wsdl.definitions.schemas, options);\n    this._initializeServices(endpoint);\n    this.httpClient = options.httpClient || new HttpClient(options);\n  }\n\n  setEndpoint(endpoint) {\n    this.endpoint = endpoint;\n    this._initializeServices(endpoint);\n  }\n\n  describe() {\n    return this.wsdl.describeServices();\n  }\n\n  setSecurity(security) {\n    this.security = security;\n  }\n\n  setSOAPAction(soapAction) {\n    this.SOAPAction = soapAction;\n  }\n\n  _initializeServices(endpoint) {\n    var definitions = this.wsdl.definitions;\n    var services = definitions.services;\n    for (var name in services) {\n      this[name] = this._defineService(services[name], endpoint);\n    }\n  }\n\n  _defineService(service, endpoint) {\n    var ports = service.ports;\n    var def = {};\n    for (var name in ports) {\n      def[name] = this._definePort(ports[name],\n        endpoint ? endpoint : ports[name].location);\n    }\n    return def;\n  }\n\n  _definePort(port, endpoint) {\n    var location = endpoint;\n    var binding = port.binding;\n    var operations = binding.operations;\n    var def = {};\n    for (var name in operations) {\n      def[name] = this._defineOperation(operations[name], location);\n      this[name] = def[name];\n    }\n    return def;\n  }\n\n  _defineOperation(operation, location) {\n    var self = this;\n    var temp;\n    return function(args, callback, options, extraHeaders) {\n      if (!args) args = {};\n      if (typeof args === 'function') {\n        callback = args;\n        args = {};\n      } else if (typeof options === 'function') {\n        temp = callback;\n        callback = options;\n        options = temp;\n      } else if (typeof extraHeaders === 'function') {\n        temp = callback;\n        callback = extraHeaders;\n        extraHeaders = options;\n        options = temp;\n      } else if (typeof callback === 'object') {\n        extraHeaders = options;\n        options = callback;\n        callback = undefined;\n      }\n      callback = callback || utils.createPromiseCallback();\n      self._invoke(operation, args, location, callback, options, extraHeaders);\n      return callback.promise;\n    };\n  }\n\n\n\n  _invoke(operation, args, location, callback, options, extraHeaders) {\n    var self = this,\n      name = operation.$name,\n      input = operation.input,\n      output = operation.output,\n      style = operation.style,\n      defs = this.wsdl.definitions,\n      ns = defs.$targetNamespace,\n      encoding = '',\n      message = '',\n      xml = null,\n      req = null,\n      soapAction,\n      headers = {\n        'Content-Type': 'text/xml; charset=utf-8'\n      },\n      dynamicSoapHeaderProperty = ['soapHeaders'],\n      dynamicSoapHeaders = {};\n\n    debug('client request. operation: %s args: %j options: %j extraHeaders: %j', operation.name, args, options, extraHeaders);\n\n    var soapNsURI = 'http://schemas.xmlsoap.org/soap/envelope/';\n    var soapNsPrefix = this.wsdl.options.envelopeKey || 'soap';\n\n    var soapVersion = this.wsdl.options.forceSoapVersion || operation.soapVersion;\n\n    if (soapVersion === '1.2') {\n      headers['Content-Type'] = 'application/soap+xml; charset=utf-8';\n      soapNsURI = 'http://www.w3.org/2003/05/soap-envelope';\n    }\n\n    debug('client request. soapNsURI: %s soapNsPrefix: %s ', soapNsURI, soapNsPrefix);\n\n    if (this.SOAPAction) {\n      soapAction = this.SOAPAction;\n    } else if (operation.soapAction != null) {\n      soapAction = operation.soapAction;\n    } else {\n      soapAction = ((ns.lastIndexOf(\"/\") !== ns.length - 1) ? ns + \"/\" : ns) + name;\n    }\n\n    if (soapVersion !== '1.2' || operation.soapActionRequired) {\n      headers.SOAPAction = '\"' + soapAction + '\"';\n    }\n\n    debug('client request. soapAction: %s', soapAction);\n\n    options = options || {};\n    debugSensitive('client request. options: %j', options);\n\n    dynamicSoapHeaders = _.merge(_.pick(extraHeaders, dynamicSoapHeaderProperty),\n\t                       _.pick(options, dynamicSoapHeaderProperty));\n\n    debug('Soap xml payload extra headers: %j', dynamicSoapHeaders);\n\n    extraHeaders = _.omit(extraHeaders, dynamicSoapHeaderProperty);\n    options = _.omit(options, dynamicSoapHeaderProperty);\n\n    //Add extra headers to http request\n    for (var header in this.httpHeaders) {\n      headers[header] = this.httpHeaders[header];\n    }\n    for (var attr in extraHeaders) {\n      headers[attr] = extraHeaders[attr];\n    }\n\n    // Clear and Add new SOAP Headers\n     if (!_.isEmpty(dynamicSoapHeaders)) {             \n        this.clearSoapHeaders();\n        for (var attr in dynamicSoapHeaders) {\n           this.addSoapHeader(dynamicSoapHeaders[attr]);\n        }\n    }\n    \n    debug('client request. headers: %j', headers);\n\n    //Unlike other security objects, NTLMSecurity is passed in through client options rather than client.setSecurity(ntlmSecurity) as some\n    //remote wsdl retrieval needs NTLM authentication before client object gets created. Hence, set NTLMSecurity instance to the client object\n    //so that it will be similar to other security objects from this point onwards.\n    if (self.httpClient.options && self.httpClient.options.NTLMSecurity) {\n      self.security = self.httpClient.options.NTLMSecurity;\n    }\n\n    // Allow the security object to add headers\n    if (self.security && self.security.addHttpHeaders) {\n      self.security.addHttpHeaders(headers);\n      debugSensitive('client request. options: %j', options);\n    }\n    if (self.security && self.security.addOptions) {\n      self.security.addOptions(options);\n      debugSensitive('client request. options: %j', options);\n    }\n\n\n\n    var nsContext = this.createNamespaceContext(soapNsPrefix, soapNsURI);\n    var xmlHandler = this.xmlHandler || new XMLHandler(this.wsdl.schemas, options);\n    var envelope = Client.createSOAPEnvelope(soapNsPrefix, soapNsURI);\n\n    var soapHeaderElement = envelope.header;\n    var soapBodyElement = envelope.body;\n    //add soapHeaders to envelope. Header can be xml, or JSON object which may or may not be described in WSDL/XSD.\n    this.addSoapHeadersToEnvelope(soapHeaderElement, this.xmlHandler);\n\n    if (self.security && self.security.addSoapHeaders) {\n      xml = self.security.addSoapHeaders(envelope.header);\n    }\n\n    let schemas = defs.schemas;\n\n\n    for(let uri in schemas) {\n      let complexTypes = schemas[uri].complexTypes;\n      if(complexTypes) {\n        for (let type in complexTypes) {\n            complexTypes[type].describe(this.wsdl.definitions);\n        }\n      }\n    }\n\n    for(let uri in schemas) {\n      let complexTypes = schemas[uri].complexTypes;\n      if(complexTypes) {\n        for (let type in complexTypes) {\n          complexTypes[type].describeChildren(this.wsdl.definitions);\n        }\n      }\n    }\n\n    var operationDescriptor = operation.describe(this.wsdl.definitions);\n    debugDetail('client request. operationDescriptor: %j', operationDescriptor);\n\n    var inputBodyDescriptor = operationDescriptor.input.body;\n    debug('client request. inputBodyDescriptor: %j', inputBodyDescriptor);\n\n    var inputHeadersDescriptor = operationDescriptor.input.headers;\n\n\n    debug('client request, calling jsonToXml. args: %j', args);\n    xmlHandler.jsonToXml(soapBodyElement, nsContext, inputBodyDescriptor, args);\n\n    if (self.security && self.security.postProcess) {\n      self.security.postProcess(envelope.header, envelope.body);\n    }\n\n    //Bydefault pretty print is true and request envelope is created with newlines and indentations\n    var prettyPrint = true;\n    //some web services don't accept request envelope with newlines and indentations in which case user has to set {prettyPrint: false} as client option\n    if (self.httpClient.options && self.httpClient.options.prettyPrint !== undefined) {\n      prettyPrint = self.httpClient.options.prettyPrint;\n    }\n\n    message = envelope.body.toString({pretty: prettyPrint});\n    xml = envelope.doc.end({pretty: prettyPrint});\n\n    debug('Request envelope: %s', xml);\n\n    self.lastMessage = message;\n    self.lastRequest = xml;\n    self.lastEndpoint = location;\n\n    self.emit('message', message);\n    self.emit('request', xml);\n\n    var tryJSONparse = function(body) {\n      try {\n        return JSON.parse(body);\n      }\n      catch (err) {\n        return undefined;\n      }\n    };\n\n    req = self.httpClient.request(location, xml, function(err, response, body) {\n      var result;\n      var obj;\n      self.lastResponse = body;\n      self.lastResponseHeaders = response && response.headers;\n      self.lastElapsedTime = response && response.elapsedTime;\n      self.emit('response', body, response);\n\n      debug('client response. response: %j body: %j', response, body);\n\n      if (err) {\n        callback(err);\n      } else {\n\n        //figure out if this is a Fault response or normal output from the server.\n        //There seem to be no good way to figure this out other than\n        //checking for <Fault> element in server response.\n        if (body.indexOf('<soap:Fault>') > -1  || body.indexOf('<Fault>') > -1) {\n          var outputEnvDescriptor = operationDescriptor.faultEnvelope;\n        } else  {\n          var outputEnvDescriptor = operationDescriptor.outputEnvelope;\n        }\n        try {\n          debugDetail('client response. outputEnvDescriptor: %j', outputEnvDescriptor);\n          obj = xmlHandler.xmlToJson(nsContext, body, outputEnvDescriptor);\n        } catch (error) {\n          //  When the output element cannot be looked up in the wsdl and the body is JSON\n          //  instead of sending the error, we pass the body in the response.\n          debug('client response. error message: %s', error.message);\n\n          if (!output) {\n            debug('client response. output not present');\n            //  If the response is JSON then return it as-is.\n            var json = _.isObject(body) ? body : tryJSONparse(body);\n            if (json) {\n              return callback(null, response, json);\n            }\n          }\n          //Reaches here for Fault processing as well since Fault is thrown as an error in xmlHandler.xmlToJson(..) function.\n          error.response = response;\n          error.body = body;\n          self.emit('soapError', error);\n          return callback(error, response, body);\n        }\n\n        if (!output || !obj.Body) {\n          // for issue 671\n          // one-way, no output expected\n          return callback(null, null, body, obj.Header);\n        }\n        if (typeof obj.Body !== 'object') {\n          var error = new Error(g.f('Cannot parse response'));\n          error.response = response;\n          error.body = body;\n          return callback(error, obj, body);\n        }\n\n        var outputBodyDescriptor = operationDescriptor.output.body;\n        var outputHeadersDescriptor = operationDescriptor.output.headers;\n\n        if (outputBodyDescriptor.elements.length) {\n          result = obj.Body[outputBodyDescriptor.elements[0].qname.name];\n        }\n        // RPC/literal response body may contain elements with added suffixes I.E.\n        // 'Response', or 'Output', or 'Out'\n        // This doesn't necessarily equal the ouput message name. See WSDL 1.1 Section 2.4.5\n        if (!result) {\n          var outputName = output.$name &&\n            output.$name.replace(/(?:Out(?:put)?|Response)$/, '');\n          result = obj.Body[outputName];\n        }\n        if (!result) {\n          ['Response', 'Out', 'Output', '.Response', '.Out', '.Output'].forEach(function(term) {\n            if (obj.Body.hasOwnProperty(name + term)) {\n              return result = obj.Body[name + term];\n            }\n          });\n        }\n        debug('client response. result: %j body: %j obj.Header: %j', result, body, obj.Header);\n\n        callback(null, result, body, obj.Header);\n      }\n    }, headers, options, self);\n\n    // Added mostly for testability, but possibly useful for debugging\n    if (req != null) {\n      self.lastRequestHeaders = req.headers;\n    }\n    debug('client response. lastRequestHeaders: %j', self.lastRequestHeaders);\n  }\n}\n\nmodule.exports = Client;\n"],"mappings":"AAAA;AACA;AACA;AACA;;AAEA,YAAY;;AAEZ,IAAIA,CAAC,GAAGC,OAAO,CAAC,aAAa,CAAC;AAC9B,IAAIC,UAAU,GAAGD,OAAO,CAAC,QAAQ,CAAC;EAChCE,MAAM,GAAGF,OAAO,CAAC,QAAQ,CAAC;EAC1BG,UAAU,GAAGH,OAAO,CAAC,YAAY,CAAC;EAClCI,UAAU,GAAGJ,OAAO,CAAC,qBAAqB,CAAC;EAC3CK,gBAAgB,GAAGL,OAAO,CAAC,oBAAoB,CAAC;EAChDM,SAAS,GAAGN,OAAO,CAAC,yBAAyB,CAAC;EAC9CO,WAAW,GAAGP,OAAO,CAAC,aAAa,CAAC,CAACO,WAAW;EAChDC,IAAI,GAAGR,OAAO,CAAC,QAAQ,CAAC;EACxBS,IAAI,GAAGT,OAAO,CAAC,MAAM,CAAC;EACtBU,CAAC,GAAGV,OAAO,CAAC,QAAQ,CAAC;EACrBW,KAAK,GAAGX,OAAO,CAAC,OAAO,CAAC,CAAC,oBAAoB,CAAC;EAC9CY,WAAW,GAAGZ,OAAO,CAAC,OAAO,CAAC,CAAC,2BAA2B,CAAC;EAC3Da,cAAc,GAAGb,OAAO,CAAC,OAAO,CAAC,CAAC,8BAA8B,CAAC;EACjEc,KAAK,GAAGd,OAAO,CAAC,SAAS,CAAC;AAE5B,MAAMe,MAAM,SAASP,IAAI,CAAC;EACxBQ,WAAWA,CAACC,IAAI,EAAEC,QAAQ,EAAEC,OAAO,EAAE;IACnC,KAAK,CAACF,IAAI,EAAEE,OAAO,CAAC;IACpBA,OAAO,GAAGA,OAAO,IAAI,CAAC,CAAC;IACvB,IAAI,CAACC,UAAU,GAAG,IAAIhB,UAAU,CAACa,IAAI,CAACI,WAAW,CAACC,OAAO,EAAEH,OAAO,CAAC;IACnE,IAAI,CAACI,mBAAmB,CAACL,QAAQ,CAAC;IAClC,IAAI,CAACM,UAAU,GAAGL,OAAO,CAACK,UAAU,IAAI,IAAIvB,UAAU,CAACkB,OAAO,CAAC;EACjE;EAEAM,WAAWA,CAACP,QAAQ,EAAE;IACpB,IAAI,CAACA,QAAQ,GAAGA,QAAQ;IACxB,IAAI,CAACK,mBAAmB,CAACL,QAAQ,CAAC;EACpC;EAEAQ,QAAQA,CAAA,EAAG;IACT,OAAO,IAAI,CAACT,IAAI,CAACU,gBAAgB,CAAC,CAAC;EACrC;EAEAC,WAAWA,CAACC,QAAQ,EAAE;IACpB,IAAI,CAACA,QAAQ,GAAGA,QAAQ;EAC1B;EAEAC,aAAaA,CAACC,UAAU,EAAE;IACxB,IAAI,CAACC,UAAU,GAAGD,UAAU;EAC9B;EAEAR,mBAAmBA,CAACL,QAAQ,EAAE;IAC5B,IAAIG,WAAW,GAAG,IAAI,CAACJ,IAAI,CAACI,WAAW;IACvC,IAAIY,QAAQ,GAAGZ,WAAW,CAACY,QAAQ;IACnC,KAAK,IAAIC,IAAI,IAAID,QAAQ,EAAE;MACzB,IAAI,CAACC,IAAI,CAAC,GAAG,IAAI,CAACC,cAAc,CAACF,QAAQ,CAACC,IAAI,CAAC,EAAEhB,QAAQ,CAAC;IAC5D;EACF;EAEAiB,cAAcA,CAACC,OAAO,EAAElB,QAAQ,EAAE;IAChC,IAAImB,KAAK,GAAGD,OAAO,CAACC,KAAK;IACzB,IAAIC,GAAG,GAAG,CAAC,CAAC;IACZ,KAAK,IAAIJ,IAAI,IAAIG,KAAK,EAAE;MACtBC,GAAG,CAACJ,IAAI,CAAC,GAAG,IAAI,CAACK,WAAW,CAACF,KAAK,CAACH,IAAI,CAAC,EACtChB,QAAQ,GAAGA,QAAQ,GAAGmB,KAAK,CAACH,IAAI,CAAC,CAACM,QAAQ,CAAC;IAC/C;IACA,OAAOF,GAAG;EACZ;EAEAC,WAAWA,CAACE,IAAI,EAAEvB,QAAQ,EAAE;IAC1B,IAAIsB,QAAQ,GAAGtB,QAAQ;IACvB,IAAIwB,OAAO,GAAGD,IAAI,CAACC,OAAO;IAC1B,IAAIC,UAAU,GAAGD,OAAO,CAACC,UAAU;IACnC,IAAIL,GAAG,GAAG,CAAC,CAAC;IACZ,KAAK,IAAIJ,IAAI,IAAIS,UAAU,EAAE;MAC3BL,GAAG,CAACJ,IAAI,CAAC,GAAG,IAAI,CAACU,gBAAgB,CAACD,UAAU,CAACT,IAAI,CAAC,EAAEM,QAAQ,CAAC;MAC7D,IAAI,CAACN,IAAI,CAAC,GAAGI,GAAG,CAACJ,IAAI,CAAC;IACxB;IACA,OAAOI,GAAG;EACZ;EAEAM,gBAAgBA,CAACC,SAAS,EAAEL,QAAQ,EAAE;IACpC,IAAIM,IAAI,GAAG,IAAI;IACf,IAAIC,IAAI;IACR,OAAO,UAASC,IAAI,EAAEC,QAAQ,EAAE9B,OAAO,EAAE+B,YAAY,EAAE;MACrD,IAAI,CAACF,IAAI,EAAEA,IAAI,GAAG,CAAC,CAAC;MACpB,IAAI,OAAOA,IAAI,KAAK,UAAU,EAAE;QAC9BC,QAAQ,GAAGD,IAAI;QACfA,IAAI,GAAG,CAAC,CAAC;MACX,CAAC,MAAM,IAAI,OAAO7B,OAAO,KAAK,UAAU,EAAE;QACxC4B,IAAI,GAAGE,QAAQ;QACfA,QAAQ,GAAG9B,OAAO;QAClBA,OAAO,GAAG4B,IAAI;MAChB,CAAC,MAAM,IAAI,OAAOG,YAAY,KAAK,UAAU,EAAE;QAC7CH,IAAI,GAAGE,QAAQ;QACfA,QAAQ,GAAGC,YAAY;QACvBA,YAAY,GAAG/B,OAAO;QACtBA,OAAO,GAAG4B,IAAI;MAChB,CAAC,MAAM,IAAI,OAAOE,QAAQ,KAAK,QAAQ,EAAE;QACvCC,YAAY,GAAG/B,OAAO;QACtBA,OAAO,GAAG8B,QAAQ;QAClBA,QAAQ,GAAGE,SAAS;MACtB;MACAF,QAAQ,GAAGA,QAAQ,IAAInC,KAAK,CAACsC,qBAAqB,CAAC,CAAC;MACpDN,IAAI,CAACO,OAAO,CAACR,SAAS,EAAEG,IAAI,EAAER,QAAQ,EAAES,QAAQ,EAAE9B,OAAO,EAAE+B,YAAY,CAAC;MACxE,OAAOD,QAAQ,CAACK,OAAO;IACzB,CAAC;EACH;EAIAD,OAAOA,CAACR,SAAS,EAAEG,IAAI,EAAER,QAAQ,EAAES,QAAQ,EAAE9B,OAAO,EAAE+B,YAAY,EAAE;IAClE,IAAIJ,IAAI,GAAG,IAAI;MACbZ,IAAI,GAAGW,SAAS,CAACU,KAAK;MACtBC,KAAK,GAAGX,SAAS,CAACW,KAAK;MACvBC,MAAM,GAAGZ,SAAS,CAACY,MAAM;MACzBC,KAAK,GAAGb,SAAS,CAACa,KAAK;MACvBC,IAAI,GAAG,IAAI,CAAC1C,IAAI,CAACI,WAAW;MAC5BuC,EAAE,GAAGD,IAAI,CAACE,gBAAgB;MAC1BC,QAAQ,GAAG,EAAE;MACbC,OAAO,GAAG,EAAE;MACZC,GAAG,GAAG,IAAI;MACVC,GAAG,GAAG,IAAI;MACVlC,UAAU;MACVmC,OAAO,GAAG;QACR,cAAc,EAAE;MAClB,CAAC;MACDC,yBAAyB,GAAG,CAAC,aAAa,CAAC;MAC3CC,kBAAkB,GAAG,CAAC,CAAC;IAEzBzD,KAAK,CAAC,qEAAqE,EAAEkC,SAAS,CAACX,IAAI,EAAEc,IAAI,EAAE7B,OAAO,EAAE+B,YAAY,CAAC;IAEzH,IAAImB,SAAS,GAAG,2CAA2C;IAC3D,IAAIC,YAAY,GAAG,IAAI,CAACrD,IAAI,CAACE,OAAO,CAACoD,WAAW,IAAI,MAAM;IAE1D,IAAIC,WAAW,GAAG,IAAI,CAACvD,IAAI,CAACE,OAAO,CAACsD,gBAAgB,IAAI5B,SAAS,CAAC2B,WAAW;IAE7E,IAAIA,WAAW,KAAK,KAAK,EAAE;MACzBN,OAAO,CAAC,cAAc,CAAC,GAAG,qCAAqC;MAC/DG,SAAS,GAAG,yCAAyC;IACvD;IAEA1D,KAAK,CAAC,iDAAiD,EAAE0D,SAAS,EAAEC,YAAY,CAAC;IAEjF,IAAI,IAAI,CAACtC,UAAU,EAAE;MACnBD,UAAU,GAAG,IAAI,CAACC,UAAU;IAC9B,CAAC,MAAM,IAAIa,SAAS,CAACd,UAAU,IAAI,IAAI,EAAE;MACvCA,UAAU,GAAGc,SAAS,CAACd,UAAU;IACnC,CAAC,MAAM;MACLA,UAAU,GAAG,CAAE6B,EAAE,CAACc,WAAW,CAAC,GAAG,CAAC,KAAKd,EAAE,CAACe,MAAM,GAAG,CAAC,GAAIf,EAAE,GAAG,GAAG,GAAGA,EAAE,IAAI1B,IAAI;IAC/E;IAEA,IAAIsC,WAAW,KAAK,KAAK,IAAI3B,SAAS,CAAC+B,kBAAkB,EAAE;MACzDV,OAAO,CAAClC,UAAU,GAAG,GAAG,GAAGD,UAAU,GAAG,GAAG;IAC7C;IAEApB,KAAK,CAAC,gCAAgC,EAAEoB,UAAU,CAAC;IAEnDZ,OAAO,GAAGA,OAAO,IAAI,CAAC,CAAC;IACvBN,cAAc,CAAC,6BAA6B,EAAEM,OAAO,CAAC;IAEtDiD,kBAAkB,GAAG1D,CAAC,CAACmE,KAAK,CAACnE,CAAC,CAACoE,IAAI,CAAC5B,YAAY,EAAEiB,yBAAyB,CAAC,EACxDzD,CAAC,CAACoE,IAAI,CAAC3D,OAAO,EAAEgD,yBAAyB,CAAC,CAAC;IAE/DxD,KAAK,CAAC,oCAAoC,EAAEyD,kBAAkB,CAAC;IAE/DlB,YAAY,GAAGxC,CAAC,CAACqE,IAAI,CAAC7B,YAAY,EAAEiB,yBAAyB,CAAC;IAC9DhD,OAAO,GAAGT,CAAC,CAACqE,IAAI,CAAC5D,OAAO,EAAEgD,yBAAyB,CAAC;;IAEpD;IACA,KAAK,IAAIa,MAAM,IAAI,IAAI,CAACC,WAAW,EAAE;MACnCf,OAAO,CAACc,MAAM,CAAC,GAAG,IAAI,CAACC,WAAW,CAACD,MAAM,CAAC;IAC5C;IACA,KAAK,IAAIE,IAAI,IAAIhC,YAAY,EAAE;MAC7BgB,OAAO,CAACgB,IAAI,CAAC,GAAGhC,YAAY,CAACgC,IAAI,CAAC;IACpC;;IAEA;IACC,IAAI,CAACxE,CAAC,CAACyE,OAAO,CAACf,kBAAkB,CAAC,EAAE;MACjC,IAAI,CAACgB,gBAAgB,CAAC,CAAC;MACvB,KAAK,IAAIF,IAAI,IAAId,kBAAkB,EAAE;QAClC,IAAI,CAACiB,aAAa,CAACjB,kBAAkB,CAACc,IAAI,CAAC,CAAC;MAC/C;IACJ;IAEAvE,KAAK,CAAC,6BAA6B,EAAEuD,OAAO,CAAC;;IAE7C;IACA;IACA;IACA,IAAIpB,IAAI,CAACtB,UAAU,CAACL,OAAO,IAAI2B,IAAI,CAACtB,UAAU,CAACL,OAAO,CAACmE,YAAY,EAAE;MACnExC,IAAI,CAACjB,QAAQ,GAAGiB,IAAI,CAACtB,UAAU,CAACL,OAAO,CAACmE,YAAY;IACtD;;IAEA;IACA,IAAIxC,IAAI,CAACjB,QAAQ,IAAIiB,IAAI,CAACjB,QAAQ,CAAC0D,cAAc,EAAE;MACjDzC,IAAI,CAACjB,QAAQ,CAAC0D,cAAc,CAACrB,OAAO,CAAC;MACrCrD,cAAc,CAAC,6BAA6B,EAAEM,OAAO,CAAC;IACxD;IACA,IAAI2B,IAAI,CAACjB,QAAQ,IAAIiB,IAAI,CAACjB,QAAQ,CAAC2D,UAAU,EAAE;MAC7C1C,IAAI,CAACjB,QAAQ,CAAC2D,UAAU,CAACrE,OAAO,CAAC;MACjCN,cAAc,CAAC,6BAA6B,EAAEM,OAAO,CAAC;IACxD;IAIA,IAAIsE,SAAS,GAAG,IAAI,CAACC,sBAAsB,CAACpB,YAAY,EAAED,SAAS,CAAC;IACpE,IAAIjD,UAAU,GAAG,IAAI,CAACA,UAAU,IAAI,IAAIhB,UAAU,CAAC,IAAI,CAACa,IAAI,CAACK,OAAO,EAAEH,OAAO,CAAC;IAC9E,IAAIwE,QAAQ,GAAG5E,MAAM,CAAC6E,kBAAkB,CAACtB,YAAY,EAAED,SAAS,CAAC;IAEjE,IAAIwB,iBAAiB,GAAGF,QAAQ,CAACX,MAAM;IACvC,IAAIc,eAAe,GAAGH,QAAQ,CAACI,IAAI;IACnC;IACA,IAAI,CAACC,wBAAwB,CAACH,iBAAiB,EAAE,IAAI,CAACzE,UAAU,CAAC;IAEjE,IAAI0B,IAAI,CAACjB,QAAQ,IAAIiB,IAAI,CAACjB,QAAQ,CAACoE,cAAc,EAAE;MACjDjC,GAAG,GAAGlB,IAAI,CAACjB,QAAQ,CAACoE,cAAc,CAACN,QAAQ,CAACX,MAAM,CAAC;IACrD;IAEA,IAAI1D,OAAO,GAAGqC,IAAI,CAACrC,OAAO;IAG1B,KAAI,IAAI4E,GAAG,IAAI5E,OAAO,EAAE;MACtB,IAAI6E,YAAY,GAAG7E,OAAO,CAAC4E,GAAG,CAAC,CAACC,YAAY;MAC5C,IAAGA,YAAY,EAAE;QACf,KAAK,IAAIC,IAAI,IAAID,YAAY,EAAE;UAC3BA,YAAY,CAACC,IAAI,CAAC,CAAC1E,QAAQ,CAAC,IAAI,CAACT,IAAI,CAACI,WAAW,CAAC;QACtD;MACF;IACF;IAEA,KAAI,IAAI6E,GAAG,IAAI5E,OAAO,EAAE;MACtB,IAAI6E,YAAY,GAAG7E,OAAO,CAAC4E,GAAG,CAAC,CAACC,YAAY;MAC5C,IAAGA,YAAY,EAAE;QACf,KAAK,IAAIC,IAAI,IAAID,YAAY,EAAE;UAC7BA,YAAY,CAACC,IAAI,CAAC,CAACC,gBAAgB,CAAC,IAAI,CAACpF,IAAI,CAACI,WAAW,CAAC;QAC5D;MACF;IACF;IAEA,IAAIiF,mBAAmB,GAAGzD,SAAS,CAACnB,QAAQ,CAAC,IAAI,CAACT,IAAI,CAACI,WAAW,CAAC;IACnET,WAAW,CAAC,yCAAyC,EAAE0F,mBAAmB,CAAC;IAE3E,IAAIC,mBAAmB,GAAGD,mBAAmB,CAAC9C,KAAK,CAACuC,IAAI;IACxDpF,KAAK,CAAC,yCAAyC,EAAE4F,mBAAmB,CAAC;IAErE,IAAIC,sBAAsB,GAAGF,mBAAmB,CAAC9C,KAAK,CAACU,OAAO;IAG9DvD,KAAK,CAAC,6CAA6C,EAAEqC,IAAI,CAAC;IAC1D5B,UAAU,CAACqF,SAAS,CAACX,eAAe,EAAEL,SAAS,EAAEc,mBAAmB,EAAEvD,IAAI,CAAC;IAE3E,IAAIF,IAAI,CAACjB,QAAQ,IAAIiB,IAAI,CAACjB,QAAQ,CAAC6E,WAAW,EAAE;MAC9C5D,IAAI,CAACjB,QAAQ,CAAC6E,WAAW,CAACf,QAAQ,CAACX,MAAM,EAAEW,QAAQ,CAACI,IAAI,CAAC;IAC3D;;IAEA;IACA,IAAIY,WAAW,GAAG,IAAI;IACtB;IACA,IAAI7D,IAAI,CAACtB,UAAU,CAACL,OAAO,IAAI2B,IAAI,CAACtB,UAAU,CAACL,OAAO,CAACwF,WAAW,KAAKxD,SAAS,EAAE;MAChFwD,WAAW,GAAG7D,IAAI,CAACtB,UAAU,CAACL,OAAO,CAACwF,WAAW;IACnD;IAEA5C,OAAO,GAAG4B,QAAQ,CAACI,IAAI,CAACa,QAAQ,CAAC;MAACC,MAAM,EAAEF;IAAW,CAAC,CAAC;IACvD3C,GAAG,GAAG2B,QAAQ,CAACmB,GAAG,CAACC,GAAG,CAAC;MAACF,MAAM,EAAEF;IAAW,CAAC,CAAC;IAE7ChG,KAAK,CAAC,sBAAsB,EAAEqD,GAAG,CAAC;IAElClB,IAAI,CAACkE,WAAW,GAAGjD,OAAO;IAC1BjB,IAAI,CAACmE,WAAW,GAAGjD,GAAG;IACtBlB,IAAI,CAACoE,YAAY,GAAG1E,QAAQ;IAE5BM,IAAI,CAACqE,IAAI,CAAC,SAAS,EAAEpD,OAAO,CAAC;IAC7BjB,IAAI,CAACqE,IAAI,CAAC,SAAS,EAAEnD,GAAG,CAAC;IAEzB,IAAIoD,YAAY,GAAG,SAAfA,YAAYA,CAAYrB,IAAI,EAAE;MAChC,IAAI;QACF,OAAOsB,IAAI,CAACC,KAAK,CAACvB,IAAI,CAAC;MACzB,CAAC,CACD,OAAOwB,GAAG,EAAE;QACV,OAAOpE,SAAS;MAClB;IACF,CAAC;IAEDc,GAAG,GAAGnB,IAAI,CAACtB,UAAU,CAACgG,OAAO,CAAChF,QAAQ,EAAEwB,GAAG,EAAE,UAASuD,GAAG,EAAEE,QAAQ,EAAE1B,IAAI,EAAE;MACzE,IAAI2B,MAAM;MACV,IAAIC,GAAG;MACP7E,IAAI,CAAC8E,YAAY,GAAG7B,IAAI;MACxBjD,IAAI,CAAC+E,mBAAmB,GAAGJ,QAAQ,IAAIA,QAAQ,CAACvD,OAAO;MACvDpB,IAAI,CAACgF,eAAe,GAAGL,QAAQ,IAAIA,QAAQ,CAACM,WAAW;MACvDjF,IAAI,CAACqE,IAAI,CAAC,UAAU,EAAEpB,IAAI,EAAE0B,QAAQ,CAAC;MAErC9G,KAAK,CAAC,wCAAwC,EAAE8G,QAAQ,EAAE1B,IAAI,CAAC;MAE/D,IAAIwB,GAAG,EAAE;QACPtE,QAAQ,CAACsE,GAAG,CAAC;MACf,CAAC,MAAM;QAEL;QACA;QACA;QACA,IAAIxB,IAAI,CAACiC,OAAO,CAAC,cAAc,CAAC,GAAG,CAAC,CAAC,IAAKjC,IAAI,CAACiC,OAAO,CAAC,SAAS,CAAC,GAAG,CAAC,CAAC,EAAE;UACtE,IAAIC,mBAAmB,GAAG3B,mBAAmB,CAAC4B,aAAa;QAC7D,CAAC,MAAO;UACN,IAAID,mBAAmB,GAAG3B,mBAAmB,CAAC6B,cAAc;QAC9D;QACA,IAAI;UACFvH,WAAW,CAAC,0CAA0C,EAAEqH,mBAAmB,CAAC;UAC5EN,GAAG,GAAGvG,UAAU,CAACgH,SAAS,CAAC3C,SAAS,EAAEM,IAAI,EAAEkC,mBAAmB,CAAC;QAClE,CAAC,CAAC,OAAOI,KAAK,EAAE;UACd;UACA;UACA1H,KAAK,CAAC,oCAAoC,EAAE0H,KAAK,CAACtE,OAAO,CAAC;UAE1D,IAAI,CAACN,MAAM,EAAE;YACX9C,KAAK,CAAC,qCAAqC,CAAC;YAC5C;YACA,IAAI2H,IAAI,GAAG5H,CAAC,CAAC6H,QAAQ,CAACxC,IAAI,CAAC,GAAGA,IAAI,GAAGqB,YAAY,CAACrB,IAAI,CAAC;YACvD,IAAIuC,IAAI,EAAE;cACR,OAAOrF,QAAQ,CAAC,IAAI,EAAEwE,QAAQ,EAAEa,IAAI,CAAC;YACvC;UACF;UACA;UACAD,KAAK,CAACZ,QAAQ,GAAGA,QAAQ;UACzBY,KAAK,CAACtC,IAAI,GAAGA,IAAI;UACjBjD,IAAI,CAACqE,IAAI,CAAC,WAAW,EAAEkB,KAAK,CAAC;UAC7B,OAAOpF,QAAQ,CAACoF,KAAK,EAAEZ,QAAQ,EAAE1B,IAAI,CAAC;QACxC;QAEA,IAAI,CAACtC,MAAM,IAAI,CAACkE,GAAG,CAACa,IAAI,EAAE;UACxB;UACA;UACA,OAAOvF,QAAQ,CAAC,IAAI,EAAE,IAAI,EAAE8C,IAAI,EAAE4B,GAAG,CAACc,MAAM,CAAC;QAC/C;QACA,IAAI,OAAOd,GAAG,CAACa,IAAI,KAAK,QAAQ,EAAE;UAChC,IAAIH,KAAK,GAAG,IAAIK,KAAK,CAAC3I,CAAC,CAAC4I,CAAC,CAAC,uBAAuB,CAAC,CAAC;UACnDN,KAAK,CAACZ,QAAQ,GAAGA,QAAQ;UACzBY,KAAK,CAACtC,IAAI,GAAGA,IAAI;UACjB,OAAO9C,QAAQ,CAACoF,KAAK,EAAEV,GAAG,EAAE5B,IAAI,CAAC;QACnC;QAEA,IAAI6C,oBAAoB,GAAGtC,mBAAmB,CAAC7C,MAAM,CAACsC,IAAI;QAC1D,IAAI8C,uBAAuB,GAAGvC,mBAAmB,CAAC7C,MAAM,CAACS,OAAO;QAEhE,IAAI0E,oBAAoB,CAACE,QAAQ,CAACnE,MAAM,EAAE;UACxC+C,MAAM,GAAGC,GAAG,CAACa,IAAI,CAACI,oBAAoB,CAACE,QAAQ,CAAC,CAAC,CAAC,CAACC,KAAK,CAAC7G,IAAI,CAAC;QAChE;QACA;QACA;QACA;QACA,IAAI,CAACwF,MAAM,EAAE;UACX,IAAIsB,UAAU,GAAGvF,MAAM,CAACF,KAAK,IAC3BE,MAAM,CAACF,KAAK,CAAC0F,OAAO,CAAC,2BAA2B,EAAE,EAAE,CAAC;UACvDvB,MAAM,GAAGC,GAAG,CAACa,IAAI,CAACQ,UAAU,CAAC;QAC/B;QACA,IAAI,CAACtB,MAAM,EAAE;UACX,CAAC,UAAU,EAAE,KAAK,EAAE,QAAQ,EAAE,WAAW,EAAE,MAAM,EAAE,SAAS,CAAC,CAACwB,OAAO,CAAC,UAASC,IAAI,EAAE;YACnF,IAAIxB,GAAG,CAACa,IAAI,CAACY,cAAc,CAAClH,IAAI,GAAGiH,IAAI,CAAC,EAAE;cACxC,OAAOzB,MAAM,GAAGC,GAAG,CAACa,IAAI,CAACtG,IAAI,GAAGiH,IAAI,CAAC;YACvC;UACF,CAAC,CAAC;QACJ;QACAxI,KAAK,CAAC,qDAAqD,EAAE+G,MAAM,EAAE3B,IAAI,EAAE4B,GAAG,CAACc,MAAM,CAAC;QAEtFxF,QAAQ,CAAC,IAAI,EAAEyE,MAAM,EAAE3B,IAAI,EAAE4B,GAAG,CAACc,MAAM,CAAC;MAC1C;IACF,CAAC,EAAEvE,OAAO,EAAE/C,OAAO,EAAE2B,IAAI,CAAC;;IAE1B;IACA,IAAImB,GAAG,IAAI,IAAI,EAAE;MACfnB,IAAI,CAACuG,kBAAkB,GAAGpF,GAAG,CAACC,OAAO;IACvC;IACAvD,KAAK,CAAC,yCAAyC,EAAEmC,IAAI,CAACuG,kBAAkB,CAAC;EAC3E;AACF;AAEAC,MAAM,CAACC,OAAO,GAAGxI,MAAM","ignoreList":[]}